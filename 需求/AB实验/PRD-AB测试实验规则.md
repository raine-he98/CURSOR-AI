# AB测试实验规则管理 PRD

## 1. 产品概述

### 1.1 产品定位
AB测试实验规则管理工具，帮助优化师科学、高效地创建和管理AB测试实验。通过先创建实验规则，再基于规则批量创建实验的方式，解决传统多计划测试中流量挤压、人群未隔离、数据对比困难等问题。

### 1.2 产品目标
- **提升测试效率**：通过规则模板化，减少重复配置工作
- **保证测试科学性**：确保实验组与对照组流量分配合理、人群隔离
- **优化决策流程**：提供清晰的实验日志和结果对比，帮助快速决策

### 1.3 核心价值
- 解决计划间互相挤压抢量的问题
- 实现人群隔离，避免同一用户看到多个实验组
- 统一管理测试数据，科学对比实验结果
- 明确停止条件，及时产出结论

---

## 2. 背景与痛点

### 2.1 业务背景
优化师在投放广告时，需要测试不同的投放要素（视频素材、落地页、定向等）的效果。传统方式是通过创建多个计划进行测试，但存在以下问题：

1. **流量分配不均**：计划之间互相挤压抢量，展示量级差距大，难以科学对比
2. **人群未隔离**：同一用户既看到实验组的广告，又看到对照组的广告，测试结果有偏差
3. **数据管理混乱**：多个测试计划数据繁复，不知指标要达到多高才能停止测试、产出结论

### 2.2 目标用户
- **主要用户**：广告优化师
- **使用场景**：需要测试不同素材效果的广告投放场景

---

## 3. 产品架构

### 3.1 整体流程
```
创建实验规则 → 基于规则创建实验 → 实验运行 → 查看实验结果 → 停止实验并得出结论
```

### 3.2 核心概念

#### 3.2.1 实验规则
实验规则是创建实验的模板，定义了实验的基本配置、参数设置和变量选择规则。一个实验规则可以创建多个实验实例。

#### 3.2.2 实验
基于实验规则创建的具体实验实例，包含实际的实验组和对照组配置。当前版本仅支持素材作为实验对象。

---

## 4. 功能需求

### 4.1 实验规则管理

#### 4.1.1 规则列表页
**页面路径**：`/abtest/rules`

**功能描述**：
- 展示所有实验规则列表
- 支持按状态、产品、创建人等条件筛选
- 支持搜索规则名称
- 提供"新建规则"入口

**列表字段**：
- 规则名称
- 产品
- 创建人
- 状态（草稿/已启用/已停用）
- 创建时间
- 操作（查看/编辑/复制/删除/实验日志）

**交互**：
- 点击规则名称或"查看"进入规则详情页
- 点击"编辑"进入编辑页
- 点击"复制"创建规则副本
- 点击"删除"删除规则（需二次确认，已创建实验的规则不可删除）
- 点击"实验日志"打开侧边栏，展示该规则创建的所有实验

---

### 4.2 实验规则详情/编辑页

**页面路径**：`/abtest/rules/:id`（查看）或 `/abtest/rules/:id/edit`（编辑）

**功能描述**：展示和编辑实验规则的完整配置信息

#### 第一部分：基本信息

**字段定义**：

| 字段名称 | 字段类型 | 是否必填 | 说明 | 示例 |
|---------|---------|---------|------|------|
| 规则名称 | 文本输入 | 是 | 实验规则的名称，用于标识和查找 | "视频素材测试规则-2024Q1" |
| 产品 | 下拉选择 | 是 | 选择应用的产品 | "产品A"、"产品B" |
| 创建人 | 自动填充 | 是 | 当前登录用户，不可编辑 | "张三" |
| 状态 | 下拉选择 | 是 | 规则状态：草稿/已启用/已停用 | "已启用" |

**交互规则**：
- 新建规则时，状态默认为"草稿"
- 只有"已启用"状态的规则才能用于创建实验
- 编辑时，已创建实验的规则状态不可修改为"已停用"

---

#### 第二部分：实验参数

**字段定义**：

| 字段名称 | 字段类型 | 是否必填 | 说明 | 示例 |
|---------|---------|---------|------|------|
| 实验变量 | 下拉选择 | 是 | 当前仅支持"素材" | "素材" |
| 命名规则 | 文本输入 | 是 | 基于此规则创建实验时的命名模板，支持变量占位符 | "{规则名称}-{日期}-{序号}" |
| 排期 | 日期范围选择 | 否 | 实验的默认排期时间，创建实验时可修改 | 2024-01-01 至 2024-01-31 |

**命名规则说明**：
- 支持变量：`{规则名称}`、`{日期}`、`{序号}`、`{时间戳}`
- 示例：`{规则名称}-{日期}` → "视频素材测试规则-2024Q1-2024-01-15"
- 如果未填写，默认使用：`{规则名称}-{日期}-{序号}`

**交互规则**：
- 实验变量当前仅支持"素材"，后续可扩展为"落地页"、"定向"等
- 排期为可选字段，不填写时创建实验需手动设置

---

#### 第三部分：选择变量和搭建参数

**功能描述**：定义实验变量的选择规则和实验搭建的具体参数

**待定内容**：
- 变量选择规则（如何从素材库中选择测试素材）
- 实验组数量设置
- 流量分配比例（如50/50、70/30）
- 对照组设置（标杆素材选择）
- 其他搭建参数

**建议字段**（待产品确认）：

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 标杆素材 | 素材选择器 | 是 | 选择作为对照组的标杆素材 |
| 测试素材数量 | 数字输入 | 是 | 需要测试的素材数量 |
| 测试素材来源 | 下拉选择 | 是 | 素材来源：素材库/手动上传/自动生成 |
| 流量分配方式 | 下拉选择 | 是 | 平均分配/自定义比例 |
| 实验组数量 | 数字输入 | 是 | 除对照组外的实验组数量（默认1组） |
| 最小样本量 | 数字输入 | 否 | 每个实验组的最小展示量要求 |
| 人群隔离规则 | 开关 | 是 | 是否启用人群隔离（默认开启） |

---

#### 第四部分：规则操作

**功能描述**：提供规则的查看、编辑、复制、删除和实验日志功能

##### 4.2.1 查看
- 进入规则详情页，以只读模式展示所有配置信息
- 状态为"已启用"的规则，提供"创建实验"按钮

##### 4.2.2 编辑
- 进入规则编辑页，可修改所有配置
- 已创建实验的规则，部分字段不可修改（如实验变量）
- 保存时进行数据校验

##### 4.2.3 复制
- 创建规则副本，规则名称自动添加"-副本"后缀
- 状态默认为"草稿"
- 复制后跳转到新规则的编辑页

##### 4.2.4 删除
- 仅"草稿"状态且未创建实验的规则可删除
- 删除前需二次确认
- 删除后不可恢复

##### 4.2.5 实验日志

**功能描述**：以侧边栏形式展示通过该规则创建的所有实验列表

**侧边栏结构**：
```
┌─────────────────────────────┐
│ 实验日志              [关闭] │
├─────────────────────────────┤
│ 规则：{规则名称}             │
│ 共 {N} 个实验                │
├─────────────────────────────┤
│ [筛选：全部/进行中/已结束]   │
├─────────────────────────────┤
│ 实验列表：                   │
│ ┌─────────────────────────┐ │
│ │ 实验名称                 │ │
│ │ 状态 | 创建时间          │ │
│ │ [查看详情]               │ │
│ └─────────────────────────┘ │
│ ...                          │
├─────────────────────────────┤
│ [创建新实验]                 │
└─────────────────────────────┘
```

**实验列表字段**：
- 实验名称
- 状态（待开始/进行中/已结束/已停止）
- 创建时间
- 操作（查看详情）

**交互**：
- 点击"查看详情"跳转到实验详情页
- 点击"创建新实验"基于当前规则创建新实验
- 支持按状态筛选实验
- 侧边栏宽度：400px，从右侧滑出

---

### 4.3 创建实验规则

**页面路径**：`/abtest/rules/new`

**功能描述**：新建实验规则

**流程**：
1. 填写第一部分：基本信息
2. 填写第二部分：实验参数
3. 填写第三部分：选择变量和搭建参数
4. 保存规则（状态默认为"草稿"）
5. 保存后可选择"立即启用"或"稍后启用"

**数据校验**：
- 规则名称：必填，长度2-50字符，不可重复
- 产品：必填
- 实验变量：必填
- 命名规则：必填，需包含至少一个变量占位符
- 第三部分字段根据最终确认的字段进行校验

---

### 4.4 基于规则创建实验

**入口**：
- 规则详情页（状态为"已启用"）
- 实验日志侧边栏

**页面路径**：`/abtest/experiments/new?ruleId=:id`

**功能描述**：基于实验规则创建具体实验

**流程**：
1. 加载规则配置作为默认值
2. 可修改实验名称（基于命名规则自动生成，可手动调整）
3. 可修改排期（如果规则中未设置）
4. 确认实验组和对照组的素材配置
5. 提交创建实验

**说明**：
- 实验创建后，系统自动进行流量分配和人群隔离
- 实验详情页功能不在本PRD范围内，后续补充

---

## 5. 页面结构

### 5.1 规则列表页布局
```
┌─────────────────────────────────────────┐
│ 页面标题：实验规则管理          [新建规则]│
├─────────────────────────────────────────┤
│ [搜索框] [状态筛选] [产品筛选] [创建人]  │
├─────────────────────────────────────────┤
│ 规则名称 │ 产品 │ 创建人 │ 状态 │ 操作  │
├─────────────────────────────────────────┤
│ 规则A   │ 产品A│ 张三  │已启用│ 操作列 │
│ 规则B   │ 产品B│ 李四  │草稿  │ 操作列 │
└─────────────────────────────────────────┘
```

### 5.2 规则详情/编辑页布局
```
┌─────────────────────────────────────────┐
│ [返回] 规则详情/编辑                     │
├─────────────────────────────────────────┤
│ 第一部分：基本信息                       │
│ ┌─────────────────────────────────────┐ │
│ │ 规则名称、产品、创建人、状态         │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 第二部分：实验参数                       │
│ ┌─────────────────────────────────────┐ │
│ │ 实验变量、命名规则、排期             │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 第三部分：选择变量和搭建参数             │
│ ┌─────────────────────────────────────┐ │
│ │ （待确认具体字段）                   │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ 第四部分：规则操作                       │
│ [查看] [编辑] [复制] [删除] [实验日志]  │
└─────────────────────────────────────────┘
```

---

## 6. 数据字段定义

### 6.1 实验规则数据模型

```json
{
  "id": "规则ID",
  "ruleName": "规则名称",
  "product": "产品ID",
  "creator": "创建人ID",
  "status": "状态：draft/enabled/disabled",
  "experimentVariable": "实验变量：material（素材）",
  "namingRule": "命名规则模板",
  "schedule": {
    "startDate": "开始日期",
    "endDate": "结束日期"
  },
  "variableSelection": {
    // 第三部分配置，待确认
  },
  "buildParams": {
    // 搭建参数，待确认
  },
  "createdAt": "创建时间",
  "updatedAt": "更新时间"
}
```

---

## 7. 异常情况处理

### 7.1 规则删除限制
- 已创建实验的规则不可删除
- 删除前提示："该规则已创建 {N} 个实验，无法删除。请先删除或停止相关实验。"

### 7.2 规则状态变更限制
- 已创建实验的规则，状态不可从"已启用"改为"已停用"
- 提示："该规则已创建实验，无法停用。"

### 7.3 命名规则校验
- 命名规则必须包含至少一个变量占位符
- 提示："命名规则需包含至少一个变量，如 {规则名称}、{日期} 等"

### 7.4 数据保存失败
- 网络错误：提示"保存失败，请检查网络连接后重试"
- 数据冲突：提示"规则名称已存在，请修改后重试"

---

## 8. 后续规划

### 8.1 功能扩展
- [ ] 支持更多实验变量：落地页、定向、出价策略等
- [ ] 支持多变量实验（A/B/C/D测试）
- [ ] 实验结果的自动分析和建议
- [ ] 规则模板库，支持复用常用配置

### 8.2 性能优化
- [ ] 规则列表分页加载
- [ ] 实验日志侧边栏虚拟滚动（实验数量多时）

### 8.3 用户体验优化
- [ ] 规则创建向导（分步引导）
- [ ] 规则配置的导入/导出
- [ ] 批量操作（批量启用/停用规则）

---

## 9. 待确认事项

1. **第三部分字段确认**：选择变量和搭建参数的具体字段定义
2. **命名规则变量**：除已列出的变量外，是否需要支持其他变量
3. **实验创建流程**：基于规则创建实验的详细流程和页面设计
4. **权限控制**：规则编辑、删除的权限规则
5. **数据统计**：规则列表是否需要展示统计信息（如创建实验数、成功率等）

---

## 10. 附录

### 10.1 术语表
- **实验规则**：创建实验的模板配置
- **实验**：基于规则创建的具体测试实例
- **实验变量**：被测试的要素（当前仅支持素材）
- **对照组**：作为基准的组（通常使用标杆素材）
- **实验组**：进行测试的组（使用测试素材）
- **人群隔离**：确保同一用户不会同时看到多个实验组

### 10.2 参考文档
- AB测试最佳实践
- 实验设计原则
- 统计显著性说明

---

**文档版本**：v1.0  
**创建日期**：2024-01-XX  
**最后更新**：2024-01-XX  
**负责人**：待定










